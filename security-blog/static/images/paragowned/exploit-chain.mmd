graph TB
    subgraph row1[" "]
        P1["PHASE 1<br/>Attacker sends iMessage<br/>with iCloud media link<br/>Passes BlastDoor validation<br/>(dormant - not malicious yet)"] --> P2["PHASE 2<br/>Missing isFromMe check<br/>Resend request flips<br/>message to is_from_me=1"]
        P2 --> P3["PHASE 3<br/>Message now trusted<br/>Malicious media processed<br/>Outside BlastDoor sandbox"]
        P3 --> P4["PHASE 4<br/>Media â†’ AI<br/>Summarization pipeline<br/>Weak input validation"]
    end

    subgraph row2[" "]
        P4 --> P5["PHASE 5<br/>WritingToolsUIService<br/>Lines 27/34: No sanitization<br/>Malicious JSON created"]
        P5 --> P6["PHASE 6 (SPECULATIVE)<br/>LLM processes bad JSON<br/>Unknown bug triggered<br/>(Markdown/Schema/Directive?)"]
        P6 --> P7["PHASE 7<br/>Code execution achieved<br/>Graphite implant deployed<br/>Persistence method unknown"]
    end

    style P1 fill:#1a1a1a,stroke:#4a4a4a,stroke-width:2px,color:#e0e0e0
    style P2 fill:#ff6b6b,stroke:#f03e3e,stroke-width:3px,color:#fff
    style P3 fill:#1a1a1a,stroke:#4a4a4a,stroke-width:2px,color:#e0e0e0
    style P4 fill:#ff8787,stroke:#f03e3e,stroke-width:2px,color:#fff
    style P5 fill:#ff6b6b,stroke:#f03e3e,stroke-width:3px,color:#fff
    style P6 fill:#a855f7,stroke:#9333ea,stroke-width:3px,color:#fff
    style P7 fill:#3b82f6,stroke:#2563eb,stroke-width:2px,color:#fff

    style row1 fill:transparent,stroke:transparent
    style row2 fill:transparent,stroke:transparent
