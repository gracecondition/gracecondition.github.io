<!DOCTYPE html>
<html lang="{{ .Site.Language.Lang | default "en" }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <title>{{ if .IsHome }}{{ .Site.Title }}{{ else }}{{ .Title }} - {{ .Site.Title }}{{ end }}</title>
    <meta name="description" content="{{ if .Description }}{{ .Description }}{{ else }}{{ .Site.Params.description }}{{ end }}">
    <meta name="author" content="{{ if .Params.author }}{{ .Params.author }}{{ else }}{{ .Site.Params.author }}{{ end }}">
    {{ with .Site.Params.keywords }}<meta name="keywords" content="{{ delimit . ", " }}">{{ end }}

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="{{ if .IsPage }}article{{ else }}website{{ end }}">
    <meta property="og:url" content="{{ .Permalink }}">
    <meta property="og:title" content="{{ if .IsHome }}{{ .Site.Title }}{{ else }}{{ .Title }}{{ end }}">
    <meta property="og:description" content="{{ if .Description }}{{ .Description }}{{ else if .Summary }}{{ .Summary }}{{ else }}{{ .Site.Params.description }}{{ end }}">
    {{ with .Params.image }}
    <meta property="og:image" content="{{ . | absURL }}">
    {{ else }}
    <meta property="og:image" content="{{ "images/default-preview.svg" | absURL }}">
    {{ end }}
    {{ if .IsPage }}
    <meta property="article:published_time" content="{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}">
    <meta property="article:modified_time" content="{{ .Lastmod.Format "2006-01-02T15:04:05Z07:00" }}">
    {{ end }}

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="{{ .Permalink }}">
    <meta name="twitter:title" content="{{ if .IsHome }}{{ .Site.Title }}{{ else }}{{ .Title }}{{ end }}">
    <meta name="twitter:description" content="{{ if .Description }}{{ .Description }}{{ else if .Summary }}{{ .Summary }}{{ else }}{{ .Site.Params.description }}{{ end }}">
    {{ with .Params.image }}
    <meta name="twitter:image" content="{{ . | absURL }}">
    {{ else }}
    <meta name="twitter:image" content="{{ "images/default-preview.svg" | absURL }}">
    {{ end }}

    <!-- Canonical URL -->
    <link rel="canonical" href="{{ .Permalink }}">

    <!-- Structured Data (JSON-LD) -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "{{ if .IsPage }}BlogPosting{{ else }}WebSite{{ end }}",
        {{ if .IsPage }}
        "headline": "{{ .Title }}",
        "description": "{{ if .Description }}{{ .Description }}{{ else if .Summary }}{{ .Summary }}{{ else }}{{ .Site.Params.description }}{{ end }}",
        "author": {
            "@type": "Person",
            "name": "{{ if .Params.author }}{{ .Params.author }}{{ else }}{{ .Site.Params.author }}{{ end }}"
        },
        "datePublished": "{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}",
        "dateModified": "{{ .Lastmod.Format "2006-01-02T15:04:05Z07:00" }}",
        {{ with .Params.image }}
        "image": "{{ . | absURL }}",
        {{ end }}
        "publisher": {
            "@type": "Organization",
            "name": "{{ .Site.Title }}",
            "url": "{{ .Site.BaseURL }}"
        },
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "{{ .Permalink }}"
        }
        {{ else }}
        "name": "{{ .Site.Title }}",
        "url": "{{ .Site.BaseURL }}",
        "description": "{{ .Site.Params.description }}"
        {{ end }}
    }
    </script>

    <link rel="stylesheet" href="{{ "css/style.css" | absURL }}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;500;600;700&family=IBM+Plex+Mono:wght@400;500;600&display=swap" rel="stylesheet">

    {{ if .Site.Params.favicon }}
    <link rel="icon" href="{{ .Site.Params.favicon | absURL }}">
    {{ end }}

    {{ block "head" . }}{{ end }}
</head>
<body>
    <canvas id="wave-gradient-canvas"></canvas>
    <div class="site-container">
        {{ partial "header.html" . }}

        <main class="main-content">
            {{ block "main" . }}{{ end }}
        </main>

        {{ partial "footer.html" . }}
    </div>

    <script type="module">
        import { WaveGradient } from 'https://unpkg.com/wave-gradient@0.1.0/dist/wave-gradient.js';

        const canvas = document.getElementById('wave-gradient-canvas');
        if (canvas) {
            const gradient = new WaveGradient(canvas, {
                colors: ['#0b0b0b', '#111111', '#151515', '#1b1b1b', '#141414', '#0b0b0b'],
                fps: 30,
                seed: 42,
                speed: 1.0,
                amplitude: 320,
            });
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script>
        // Simple mobile-friendly Mermaid config
        const isMobile = window.innerWidth <= 768;

        mermaid.initialize({
            startOnLoad: true,
            theme: 'dark',
            themeVariables: {
                darkMode: true,
                background: '#0b0b0b',
                primaryColor: '#171717',
                primaryTextColor: '#e0e0e0',
                primaryBorderColor: '#2c2c2c',
                lineColor: '#3a3a3a',
                secondaryColor: '#1f1f1f',
                tertiaryColor: '#121212',
                fontSize: '14px',
                fontFamily: 'IBM Plex Sans, Space Grotesk, sans-serif'
            },
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            },
            sequence: {
                useMaxWidth: true
            },
            gantt: {
                useMaxWidth: true
            }
        });
    </script>
    <script src="{{ "js/waves.js" | absURL }}"></script>
    <script src="{{ "js/main.js" | absURL }}"></script>
    {{ block "scripts" . }}{{ end }}
</body>
</html>
