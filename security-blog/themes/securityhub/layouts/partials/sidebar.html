<aside class="sidebar">
    <div class="sidebar-content">
        <!-- BULLETPROOF SEARCH -->
        <div class="sidebar-section">
            <h3 class="sidebar-title">ğŸ” Search</h3>
            <div class="search-container-robust">
                <input type="text" id="search-input-robust" class="search-input-robust" placeholder="Type to search..." autocomplete="off">
                <button id="search-clear-robust" class="search-clear-robust">Ã—</button>
            </div>

            <!-- SEARCH RESULTS (HIDDEN BY DEFAULT) -->
            <div id="search-results-robust" class="search-results-robust" style="display: none;">
                <div class="search-results-header-robust">
                    <span id="search-count-robust"></span>
                </div>
                <div class="search-results-scrollable">
                    <div id="search-list-robust">
                        <!-- Results will be populated here when searching -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Categories Section -->
        <div class="sidebar-section">
            <h3 class="sidebar-title">Categories</h3>
            <div class="category-filters">
                <button class="category-filter active" data-category="all">All Posts</button>
                <button class="category-filter" data-category="research">ğŸ”¬ Research</button>
                <button class="category-filter" data-category="analysis">ğŸ” Analysis</button>
                <button class="category-filter" data-category="tutorial">ğŸ“š Tutorial</button>
                <button class="category-filter" data-category="ctf">ğŸš© CTF</button>
            </div>
        </div>

        <!-- Recent Posts Section -->
        <div class="sidebar-section">
            <h3 class="sidebar-title">Recent Posts</h3>
            <div class="recent-posts">
                {{ range first 5 (where .Site.RegularPages "Type" "in" (slice "posts" "articles")) }}
                <article class="recent-post-item" data-category="{{ .Params.category | default "security" }}">
                    <a href="{{ .Permalink }}" class="recent-post-link">
                        <div class="recent-post-meta">
                            <span class="recent-post-category category-{{ .Params.category | default "security" }}">
                                {{ if eq .Params.category "ctf" }}ğŸš©
                                {{ else if eq .Params.category "research" }}ğŸ”¬
                                {{ else if eq .Params.category "analysis" }}ğŸ”
                                {{ else if eq .Params.category "tutorial" }}ğŸ“š
                                {{ else }}ğŸ”{{ end }}
                            </span>
                            <time class="recent-post-date">{{ .Date.Format "Jan 2" }}</time>
                        </div>
                        <h4 class="recent-post-title">{{ .Title | truncate 60 }}</h4>
                        <p class="recent-post-excerpt">{{ .Summary | truncate 80 }}</p>
                    </a>
                </article>
                {{ end }}
            </div>
        </div>

        <!-- CTF Competitions Section -->
        {{ $ctfPages := where .Site.RegularPages "Section" "ctf" }}
        {{ if $ctfPages }}
        <div class="sidebar-section">
            <h3 class="sidebar-title">CTF Competitions</h3>
            {{ $ctfSections := where .Site.Sections "Section" "ctf" }}
            {{ range $ctfSections.GroupByParam "ctf_type" }}
            <div class="ctf-category-group">
                {{ if .Key }}
                <h4 class="ctf-category-title">
                    {{ if eq .Key "wargame" }}ğŸ¯ Wargames
                    {{ else if eq .Key "competition" }}ğŸ† Competitions
                    {{ else if eq .Key "practice" }}ğŸ’ª Practice
                    {{ else }}ğŸš© {{ .Key | title }}{{ end }}
                </h4>
                {{ end }}
                <div class="ctf-competitions">
                    {{ range .Pages }}
                    <article class="ctf-competition-item">
                        <a href="{{ .Permalink }}" class="ctf-competition-link">
                            <div class="ctf-competition-meta">
                                <span class="ctf-badge-small">ğŸš©</span>
                                {{ if .Params.ctf_date }}
                                <time class="ctf-date-small">{{ .Params.ctf_date }}</time>
                                {{ end }}
                            </div>
                            <h4 class="ctf-competition-name">{{ .Title }}</h4>
                            {{ if .Params.placement }}
                            <span class="ctf-placement-small">{{ .Params.placement }}</span>
                            {{ end }}
                        </a>
                    </article>
                    {{ end }}
                </div>
            </div>
            {{ end }}
        </div>
        {{ end }}

        <!-- All Posts by Category -->
        <div class="sidebar-section">
            <h3 class="sidebar-title">All Posts</h3>
            <div class="posts-by-category">
                {{ $posts := where .Site.RegularPages "Type" "in" (slice "posts" "articles") }}
                {{ $ctfChallenges := where .Site.RegularPages "Section" "ctf" }}

                <!-- CTF Challenges Group -->
                {{ if $ctfChallenges }}
                <div class="category-group">
                    <h4 class="category-group-title">
                        ğŸš© CTF Challenges
                        <span class="post-count">({{ len $ctfChallenges }})</span>
                    </h4>
                    <ul class="category-post-list">
                        {{ range first 8 $ctfChallenges }}
                        <li class="category-post-item" data-category="ctf">
                            <a href="{{ .Permalink }}" class="category-post-link">
                                <span class="category-post-title">{{ .Title | truncate 50 }}</span>
                                <time class="category-post-date">{{ .Date.Format "Jan 2" }}</time>
                            </a>
                        </li>
                        {{ end }}
                        {{ if gt (len $ctfChallenges) 8 }}
                        <li class="show-more-item">
                            <button class="show-more-btn" data-category="ctf">
                                Show {{ sub (len $ctfChallenges) 8 }} more...
                            </button>
                        </li>
                        {{ end }}
                    </ul>
                </div>
                {{ end }}
                {{ range $posts.GroupByParam "category" }}
                <div class="category-group">
                    <h4 class="category-group-title">
                        {{ if eq .Key "ctf" }}ğŸš© CTF
                        {{ else if eq .Key "research" }}ğŸ”¬ Research
                        {{ else if eq .Key "analysis" }}ğŸ” Analysis
                        {{ else if eq .Key "tutorial" }}ğŸ“š Tutorial
                        {{ else }}ğŸ” {{ .Key | title }}{{ end }}
                        <span class="post-count">({{ len .Pages }})</span>
                    </h4>
                    <ul class="category-post-list">
                        {{ range first 8 .Pages }}
                        <li class="category-post-item" data-category="{{ .Params.category | default "security" }}">
                            <a href="{{ .Permalink }}" class="category-post-link">
                                <span class="category-post-title">{{ .Title | truncate 50 }}</span>
                                <time class="category-post-date">{{ .Date.Format "Jan 2" }}</time>
                            </a>
                        </li>
                        {{ end }}
                        {{ if gt (len .Pages) 8 }}
                        <li class="show-more-item">
                            <button class="show-more-btn" data-category="{{ .Key }}">
                                Show {{ sub (len .Pages) 8 }} more...
                            </button>
                        </li>
                        {{ end }}
                    </ul>
                </div>
                {{ end }}
            </div>
        </div>

        <!-- Tags Section -->
        <div class="sidebar-section">
            <h3 class="sidebar-title">Popular Tags</h3>
            <div class="tag-cloud">
                {{ range first 20 .Site.Taxonomies.tags.ByCount }}
                <a href="{{ .Page.Permalink }}" class="tag-link" data-count="{{ .Count }}">
                    #{{ .Page.Title }}
                    <span class="tag-count">{{ .Count }}</span>
                </a>
                {{ end }}
            </div>
        </div>
    </div>
</aside>